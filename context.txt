# THE MARGONEM MINIMAP HUNTER - MODULAR PROJECT BIBLE

## 1. CORE ARCHITECTURE
The project has been refactored into a modular structure for better maintainability and testing.

*   **`main.py`**: The central orchestrator. Manages the state machine (Hunting vs. Selling vs. Returning) and handles the main bot loop.
*   **`scripts/vision_engine.py`**: The "Eyes". Contains all OpenCV detection logic for monsters, doors, and player positions. Also handles OCR text cleaning.
*   **`scripts/movement.py`**: Handles character stability and interruptible travel logic (`wait_until_stopped`).
*   **`scripts/routines.py`**: High-level macros for "Full Bag" selling and "Recovery" return paths.
*   **`controls.py`**: Hardware abstraction layer for mouse/keyboard simulation.
*   **`ocr.py`**: Low-level Tesseract engine configuration.

## 2. STANDARDIZED VISION SETTINGS
These parameters have been verified across 10+ map samples and represent the "Absolute Perfect" baseline.

### **Monster Detection (Red)**
*   **Filters:** Hue 0-10 & 170-180, S/V > 70.
*   **Geometry:** Area 30-400px, Extent > 0.4, Aspect 0.7-1.4.
*   **Constraint:** Clean edges (No morphological closing). Player masking (8px radius) is used to prevent self-overlap.

### **Door Detection (Blue)**
*   **Filters:** Hue 110-125, **Saturation > 150, Value > 150**. (Very strict to ignore map noise).
*   **Geometry:** Area 20-600px, **Extent > 0.50**.
*   **Processing:** Uses `MORPH_CLOSE` (3x3 kernel). Verified to detect exactly **1 door** in Map 3 and ignore all noise.

## 3. ADVANCED FEATURES
*   **Queue Navigation:** `ALLOWED_MAPS` acts as a priority queue. Maps are rotated to the end only upon confirmed arrival at a destination.
*   **Interruptible Travel:** When exploring, the bot will immediately cancel a walk to a door if a valid monster appears.
*   **'P' Key Strategy:** Automatic fallback to return via 'P' if spawned on a hidden door with no other visible targets.
*   **Auto-Heal:** Single-pixel monitor on the health orb with a 0.5s rapid-fire cooldown for deep health drops.
*   **Auto-Selling:** Detects 0-1 free slots -> Teleports -> Enters "Dom Tunii" -> Executes Trade Macro -> Returns to farm zone via fixed `RECOVERY_ROUTE`.

## 4. OCR OPTIMIZATION
*   **Preprocessing:** Grayscale -> 3x Cubic Resize -> High Threshold (180).
*   **Engine:** PSM 6 (Single block).
*   **Fuzzy Matching:** Matching logic ignores all spaces and capitalization (e.g., "p1s1" == "P1 S1").